---
import type { SiteConfig } from '~/types/site';

// 1. Import all site configs eagerly
const configs = import.meta.globEager('../content/sites/*.ts') as Record<string, { default: SiteConfig }>;

// 2. Tell Astro which slugs to build
export function getStaticPaths() {
  return Object.entries(configs).map(([filePath, mod]) => {
    // filePath example: "../content/sites/photographer.ts"
    const match = filePath.match(/\/([^\/]+)\.ts$/);
    return { params: { site: match![1] } };
  });
}

// 3. Grab the requested slug
const { site: slug } = Astro.params;

// 4. Look up that config module
const modulePath = `../content/sites/${slug}.ts`;
const siteModule = configs[modulePath];
if (!siteModule) {
  throw new Error(`No site config found for slug "${slug}"`);
}

// 5. Extract your typed config
const config: SiteConfig = siteModule.default;

// 6. Import your layout & page components
import BaseLayout   from '~/layouts/BaseLayout.astro';
import Hero         from '~/components/Hero.astro';
import About        from '~/components/About.astro';
import Services     from '~/components/Services.astro';
import Testimonials from '~/components/Testimonials.astro';
import Gallery      from '~/components/Gallery.astro';
import Cta          from '~/components/cta.astro';
---

<BaseLayout config={config}>
  <Hero         {...config.hero}                    branding={config.branding} />
  <About        {...config.about}                                   />
  <Services     {...config.servicesSection}                          />
  <Testimonials {...config.testimonialsSection}                      />
  <Gallery      items={config.gallery}                             />
  <Cta          {...config.ctaSection}                              />
</BaseLayout>
